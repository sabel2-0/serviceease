{"mappings":"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","sources":["src/js/auth.js"],"sourcesContent":["// Function to verify user role and redirect if unauthorized\r\nfunction verifyRole(allowedRoles) {\r\n    const user = getCurrentUser();\r\n    \r\n    // If no user is logged in, redirect to login\r\n    if (!user || !isLoggedIn()) {\r\n        window.location.href = '/pages/login.html';\r\n        return false;\r\n    }\r\n\r\n    // If user's role is not in the allowed roles, redirect to their appropriate dashboard\r\n    if (!allowedRoles.includes(user.role)) {\r\n        // Get current path\r\n        const currentPath = window.location.pathname;\r\n        let targetPath = '';\r\n        switch (user.role) {\r\n            case 'admin':\r\n                targetPath = '/pages/admin/admin.html';\r\n                break;\r\n            case 'operations_officer':\r\n                targetPath = '/pages/operations-officer/operations-officer.html';\r\n                break;\r\n            case 'technician':\r\n                targetPath = '/pages/technician/technician.html';\r\n                break;\r\n            case 'requester':\r\n                targetPath = '/pages/requester/requester.html';\r\n                break;\r\n            case 'coordinator':\r\n                targetPath = '/pages/coordinator/coordinator.html';\r\n                break;\r\n            default:\r\n                targetPath = '/pages/login.html'; // fallback to login for unknown roles\r\n        }\r\n        // Only redirect if not already on the correct dashboard\r\n        if (currentPath !== targetPath) {\r\n            window.location.href = targetPath;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// Function to get current path information\r\nfunction getCurrentPathInfo() {\r\n    const path = window.location.pathname;\r\n    const pathParts = path.split('/').filter(Boolean);\r\n    \r\n    if (pathParts.length >= 2 && pathParts[0] === 'pages') {\r\n        return {\r\n            section: pathParts[1], // e.g., 'operations-officer', 'admin', etc.\r\n            page: pathParts[2] // The specific page name\r\n        };\r\n    }\r\n    return null;\r\n}\r\n\r\n// Function to check if user is accessing the correct section\r\nfunction verifySectionAccess() {\r\n    const user = getCurrentUser();\r\n    if (!user || !isLoggedIn()) {\r\n        window.location.href = '/pages/login.html';\r\n        return false;\r\n    }\r\n\r\n    const pathInfo = getCurrentPathInfo();\r\n    if (!pathInfo) return true; // Skip check if not in a section\r\n\r\n    // Define shared pages that operations officers can access from admin section\r\n    const sharedAdminPages = [\r\n        'walk-in-service-requests.html',\r\n        'parts-requests.html',\r\n        'service-history.html',\r\n        'client-management.html',\r\n        'client-printers.html',\r\n        'inventory-items.html',\r\n        'inventory-parts.html',\r\n        'coordinator-accounts.html',\r\n        'coordinator-approvals.html'\r\n    ];\r\n\r\n    // Allow operations officers to access certain admin pages\r\n    if (user.role === 'operations_officer' && \r\n        pathInfo.section === 'admin' && \r\n        sharedAdminPages.includes(pathInfo.page)) {\r\n        return true; // Allow access to shared pages\r\n    }\r\n\r\n    const allowedSection = (() => {\r\n        switch (user.role) {\r\n            case 'admin': return 'admin';\r\n            case 'operations_officer': return 'operations-officer';\r\n            case 'technician': return 'technician';\r\n            case 'requester': return 'requester';\r\n            case 'coordinator': return 'coordinator';\r\n            default: return null; // fallback for unknown roles\r\n        }\r\n    })();\r\n\r\n    if (allowedSection && pathInfo.section !== allowedSection) {\r\n        const targetPath = `/pages/${allowedSection}/${allowedSection}.html`;\r\n        // Only redirect if not already on the correct dashboard\r\n        if (window.location.pathname !== targetPath) {\r\n            window.location.href = targetPath;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// Function to show email verification alert\r\nfunction showEmailVerificationAlert() {\r\n    // Create the alert container\r\n    const alertContainer = document.createElement('div');\r\n    alertContainer.className = 'fixed top-4 right-4 max-w-sm w-full bg-yellow-50 border-l-4 border-yellow-400 p-4 shadow-lg rounded-lg';\r\n    alertContainer.innerHTML = `\r\n        <div class=\"flex items-start\">\r\n            <div class=\"flex-shrink-0\">\r\n                <i class=\"fas fa-exclamation-circle text-yellow-400 text-lg\"></i>\r\n            </div>\r\n            <div class=\"ml-3\">\r\n                <h3 class=\"text-sm font-medium text-yellow-800\">\r\n                    Email Verification Required\r\n                </h3>\r\n                <div class=\"mt-2 text-sm text-yellow-700\">\r\n                    <p>Please verify your email address to access all features.</p>\r\n                </div>\r\n                <div class=\"mt-4\">\r\n                    <div class=\"-mx-2 -my-1.5 flex\">\r\n                        <button onclick=\"sendVerificationEmail()\" class=\"bg-yellow-50 px-2 py-1.5 rounded-md text-sm font-medium text-yellow-800 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-yellow-50 focus:ring-yellow-600\">\r\n                            Verify Email\r\n                        </button>\r\n                        <button onclick=\"this.parentElement.parentElement.parentElement.parentElement.remove()\" class=\"ml-3 bg-yellow-50 px-2 py-1.5 rounded-md text-sm font-medium text-yellow-800 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-yellow-50 focus:ring-yellow-600\">\r\n                            Dismiss\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n    document.body.appendChild(alertContainer);\r\n\r\n    // Auto-hide after 10 seconds\r\n    setTimeout(() => {\r\n        if (alertContainer.parentElement) {\r\n            alertContainer.remove();\r\n        }\r\n    }, 10000);\r\n}\r\n\r\n// Function to send verification email\r\nasync function sendVerificationEmail() {\r\n    const user = JSON.parse(localStorage.getItem('user'));\r\n    if (!user) return;\r\n\r\n    try {\r\n        const response = await fetch('/api/send-verification-email', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({\r\n                userId: user.id,\r\n                email: user.email\r\n            })\r\n        });\r\n\r\n        const data = await response.json();\r\n        if (response.ok) {\r\n            alert('Verification email sent! Please check your inbox.');\r\n        } else {\r\n            throw new Error(data.error || 'Failed to send verification email');\r\n        }\r\n    } catch (error) {\r\n        console.error('Error sending verification email:', error);\r\n        alert('Error sending verification email. Please try again.');\r\n    }\r\n}\r\n\r\n// Function to handle user login\r\nasync function loginUser({ email, password }) {\r\n    try {\r\n        const response = await fetch('/api/login', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json'\r\n            },\r\n            body: JSON.stringify({ email, password })\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (!response.ok) {\r\n            throw new Error(data.error || 'Login failed');\r\n        }\r\n\r\n        // Store user data in localStorage\r\n        localStorage.setItem('user', JSON.stringify(data.user));\r\n        localStorage.setItem('isLoggedIn', 'true');\r\n        \r\n        // Store token if provided\r\n        if (data.token) {\r\n            localStorage.setItem('token', data.token);\r\n        }\r\n\r\n        // Only show approval alert for pending users\r\n        if (data.user.approvalStatus === 'pending') {\r\n            localStorage.setItem('showApprovalAlert', 'true');\r\n        }\r\n\r\n        // Get the base path dynamically\r\n        const currentPath = window.location.pathname;\r\n        let basePath = '';\r\n        \r\n        // If we're in the pages directory\r\n        if (currentPath.includes('/pages/')) {\r\n            // We're in a pages subdirectory\r\n            if (currentPath.split('/').filter(Boolean).length > 2) {\r\n                basePath = '../'; // Go up one level (e.g., from /pages/subdir/ to /pages/)\r\n            }\r\n            // Otherwise we're directly in /pages/, so no need for a base path\r\n        } else {\r\n            // We're somewhere else, default to going to pages/\r\n            basePath = 'pages/';\r\n        }\r\n        \r\n        // Redirect based on role\r\n        if (data.user.role === 'admin') {\r\n            window.location.href = `${basePath}admin/admin.html`;\r\n        } else if (data.user.role === 'operations_officer') {\r\n            window.location.href = `${basePath}operations-officer/operations-officer.html`;\r\n        } else if (data.user.role === 'technician') {\r\n            window.location.href = `${basePath}technician/technician.html`;\r\n        } else if (data.user.role === 'requester') {\r\n            // Requester users have a dedicated mobile/compact UI\r\n            window.location.href = `${basePath}requester/requester.html`;\r\n        } else {\r\n            // All other users (including coordinators) go to coordinator.html\r\n            window.location.href = `${basePath}coordinator/coordinator.html`;\r\n        }\r\n\r\n        return data;\r\n    } catch (error) {\r\n        throw new Error(error.message || 'Login failed');\r\n    }\r\n}\r\n\r\n// Function to check if user is logged in\r\nfunction isLoggedIn() {\r\n    return localStorage.getItem('isLoggedIn') === 'true';\r\n}\r\n\r\n// Function to get current user data\r\nfunction getCurrentUser() {\r\n    const userData = localStorage.getItem('user');\r\n    return userData ? JSON.parse(userData) : null;\r\n}\r\n\r\n// Function to handle user registration\r\nasync function registerUser(formData) {\r\n    try {\r\n        // Create FormData to handle file uploads\r\n        const registrationData = new FormData();\r\n        \r\n        // Add text fields\r\n        registrationData.append('firstName', formData.firstName);\r\n        registrationData.append('lastName', formData.lastName);\r\n        registrationData.append('email', formData.email);\r\n        registrationData.append('password', formData.password);\r\n        registrationData.append('role', 'coordinator'); // Default role for registration\r\n        \r\n        // Add institutionId if provided (from the institution selection dropdown)\r\n        if (formData.institutionId) {\r\n            registrationData.append('institutionId', formData.institutionId);\r\n        }\r\n        \r\n        // Add photo files if they exist\r\n        const frontIdInput = document.getElementById('front-id-upload');\r\n        const backIdInput = document.getElementById('back-id-upload');\r\n        const selfieInput = document.getElementById('selfie-upload');\r\n        \r\n        if (frontIdInput && frontIdInput.files[0]) {\r\n            registrationData.append('frontId', frontIdInput.files[0]);\r\n        }\r\n        if (backIdInput && backIdInput.files[0]) {\r\n            registrationData.append('backId', backIdInput.files[0]);\r\n        }\r\n        if (selfieInput && selfieInput.files[0]) {\r\n            registrationData.append('selfie', selfieInput.files[0]);\r\n        }\r\n\r\n        const response = await fetch('/api/register', {\r\n            method: 'POST',\r\n            body: registrationData // Don't set Content-Type header, let browser set it for FormData\r\n        });\r\n\r\n        const data = await response.json();\r\n\r\n        if (!response.ok) {\r\n            throw new Error(data.error || 'Registration failed');\r\n        }\r\n\r\n        return data;\r\n    } catch (error) {\r\n        throw new Error(error.message || 'Registration failed');\r\n    }\r\n}\r\n\r\n// Function to handle logout\r\nfunction logout() {\r\n    localStorage.removeItem('user');\r\n    localStorage.removeItem('isLoggedIn');\r\n    localStorage.removeItem('token'); // Also remove token\r\n    window.location.href = '/pages/login.html'; // Corrected path\r\n}\r\n"],"names":[],"version":3,"file":"register.ad25af97.js.map","sourceRoot":"/__parcel_source_root/"}